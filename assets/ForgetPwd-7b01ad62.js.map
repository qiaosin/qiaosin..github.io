{"version":3,"file":"ForgetPwd-7b01ad62.js","sources":["../../src/components/user/ResetForm.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { ref, reactive, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport Form from '@/components/common/Form.vue'\nimport { userResetPwdApi, getValidCodeApi } from '@/api/user'\nconst { t, locale } = useI18n()\nimport Message from '@/utils/message'\nimport { useRouter } from 'vue-router'\nimport { onMounted } from 'vue'\n\nconst router = useRouter()\n\n// const step = ref(0)\n\nconst handleEmailCountdown = () => {\n  const countDownTime = localStorage.getItem('ahab_email_time')\n  if (countDownTime) {\n    let remainTime = Math.floor((+countDownTime + 60 * 1000 - new Date().getTime()) / 1000)\n    if (remainTime > 0) {\n      formConfig.value.email.buttonText = `${remainTime}s`\n      formConfig.value.email.buttonDisabled = true\n      const inter = setInterval(() => {\n        if (remainTime <= 1) {\n          clearInterval(inter)\n          formConfig.value.email.buttonText = t('login.sendVfcCode')\n          formConfig.value.email.buttonDisabled = false\n          return\n        }\n        formConfig.value.email.buttonText = `${--remainTime}s`\n      }, 1000)\n    }\n  }\n}\n\nconst ruleForm = reactive({\n  email: '',\n  verificationCode: '',\n  password: '',\n  confirmPassword: '',\n})\nconst handleSendVerificationCode = async () => {\n  try {\n    console.log('send code')\n    localStorage.setItem('ahab_email_time', '' + new Date().getTime())\n    handleEmailCountdown()\n    const res: any = await getValidCodeApi({ email: ruleForm.email })\n    console.log(res, '===res')\n    if (res.statusCode === 200) {\n      Message.toast('验证码发送成功！')\n    } else {\n      Message.error(res.message)\n    }\n  } catch (error: any) {\n    Message.error(error.message || error.data.message)\n  }\n}\nconst handleEmailBlur = (value: string) => {\n  console.log('blur', value)\n  const regExt = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,}$/\n  if (value && regExt.test(value)) {\n    formConfig.value.email.buttonDisabled = false\n  } else {\n    formConfig.value.email.buttonDisabled = true\n  }\n}\nconst initConfig = () => ({\n  email: {\n    placeholder: t('login.email'),\n    onBlur: handleEmailBlur,\n    withButton: true,\n    buttonText: t('login.sendVfcCode'),\n    buttonDisabled: true,\n    buttonClick: handleSendVerificationCode,\n  },\n  verificationCode: {\n    placeholder: t('login.verificationCode'),\n  },\n  password: {\n    placeholder: t('login.password'),\n    type: 'password',\n  },\n  confirmPassword: {\n    placeholder: t('login.confirmPassword'),\n    type: 'password',\n  },\n})\nconst formConfig = ref(initConfig())\n\nhandleEmailCountdown()\n\nconst initRule = () => ({\n  verificationCode: [\n    {\n      required: true,\n      message: t('login.vfcCodeNull'),\n      trigger: 'blur',\n    },\n  ],\n  email: [\n    {\n      required: true,\n      message: t('login.emailNull'),\n      trigger: 'blur',\n    },\n    {\n      type: 'email',\n      message: t('login.emailError'),\n      trigger: 'blur',\n    },\n  ],\n  password: [\n    {\n      validator: validatePass(),\n      trigger: 'blur',\n    },\n  ],\n  confirmPassword: [\n    {\n      validator: validatePass2(),\n      trigger: 'blur',\n    },\n  ],\n})\nconst regExt = /^(?![a-zA-Z]+$)(?!\\d+$)(?![^\\da-zA-Z\\s]+$).{6,12}$/\n\nconst validatePass = () => (_rule: any, value: any, callback: any) => {\n  try {\n    if (value === '') {\n      callback(new Error(t('login.passwordNull')))\n    } else if (!regExt.test(value)) {\n      callback(new Error(t('login.passwordInvalid')))\n    } else {\n      if (ruleForm.confirmPassword !== ruleForm.password) {\n        callback(new Error(t('login.confirmPasswordError')))\n        // if (!ruleFormRef.value) return\n        // ruleFormRef.value.validateField('confirmPassword', () => null)\n      }\n      callback()\n    }\n  } catch (error) {\n    console.log(error)\n  }\n}\nconst validatePass2 = () => (_rule: any, value: any, callback: any) => {\n  if (value === '') {\n    callback(new Error(t('login.confirmPasswordNull')))\n  } else if (value !== ruleForm.password) {\n    callback(new Error(t('login.confirmPasswordError')))\n  } else {\n    callback()\n  }\n}\n\nconst rules = ref(initRule())\n\nconst submitForm = async () => {\n  try {\n    const res: any = await userResetPwdApi({\n      email: ruleForm.email,\n      code: ruleForm.verificationCode,\n      password: ruleForm.password,\n    })\n    console.log(res, '===res')\n    if (res.statusCode === 200) {\n      Message.success(t('login.resetSuccess'))\n\n      router.push('login')\n    } else {\n      Message.error(res.message)\n    }\n  } catch (error: any) {\n    Message.error(error.message || error.data.message)\n  }\n}\n\nwatch(locale, () => {\n  rules.value = initRule()\n  formConfig.value = initConfig()\n})\n\nonMounted(() => {\n  // step.value = 0\n})\n</script>\n<template>\n  <div class=\"user-form\">\n    <div class=\"user-form-title\">{{ t('login.findAccount') }}</div>\n    <div class=\"user-form-title2\">\n      <p class=\"user-form-title2-p\">{{ t('login.findTips') }}</p>\n    </div>\n    <Form\n      v-model:ruleForm=\"ruleForm\"\n      :formConfig=\"formConfig\"\n      :rules=\"rules\"\n      :confirmText=\"t('confirm')\"\n      :resetText=\"t('reset')\"\n      :showReset=\"false\"\n      @submit=\"submitForm\"\n    ></Form>\n  </div>\n</template>\n<style lang=\"scss\" scoped>\n@use '@/assets/scss/user/index.scss';\n</style>\n"],"names":["t","locale","useI18n","router","useRouter","handleEmailCountdown","countDownTime","remainTime","formConfig","inter","ruleForm","reactive","handleSendVerificationCode","res","getValidCodeApi","Message","error","handleEmailBlur","value","initConfig","ref","initRule","validatePass","validatePass2","regExt","_rule","callback","rules","submitForm","userResetPwdApi","watch","onMounted"],"mappings":"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"}